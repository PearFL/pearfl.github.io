---
title: mapreduce解析json数据
date: 2020-2-9 00:30:22
tags:
 - json
 - mapreduce
categories: 大数据
---

```
输入数据
{"status":"0","message":"成功","data":{"name":"mxh" , "age":22 , "cars":[{"id":1,"name":"Porsche"},{"id":2,"name":"BMW"}]}}
{"status":"0","message":"成功","data":{"name":"mxh" , "age":22 , "cars":[ "Porsche", "BMW", "Volvo" ]}}
{"status":"0","message":"成功","data":{"name":"mxh" , "age":22 , "male":true}}

输出数据
0	成功	mxh	22	1	Porsche	2	BMW	
0	成功	mxh	22	Porsche	BMW	Volvo	
0	成功	mxh	22	true	
```

解析采用jackson


```java
public class JsonDriver {
    public static void main(String[] args) throws Exception{
        String input = "data/json/data.txt";
        String output = "out";

        // 1:获取job对象
        Configuration configuration = new Configuration();
        Job job = Job.getInstance(configuration);

        //删除已存在目录
        FileUtils.deleteOutput(configuration,output);

        // 2：本job对应执行的主类
        job.setJarByClass(JsonDriver.class);

        // 3）设置Mapper
        job.setMapperClass(MyMapper.class);

        // 4）设置Mapper阶段输出数据的类型
        job.setMapOutputKeyClass(Text.class);
        job.setMapOutputValueClass(NullWritable.class);

        // 5）设置输入和输出路径
        FileInputFormat.setInputPaths(job, new Path(input));
        FileOutputFormat.setOutputPath(job, new Path(output));

        // 6）提交作业
        boolean result = job.waitForCompletion(true);
        System.exit(result ? 0 : 1);
    }

    public static class MyMapper extends Mapper<LongWritable,Text,Text,NullWritable>{
        protected void map(LongWritable key,Text values,Context context) throws IOException,InterruptedException{
            String str = values.toString();
            String out = "";

            ObjectMapper mapper = new ObjectMapper();
            JsonNode root = mapper.readTree(str);

            Iterator<JsonNode> elements = root.elements();
            out = dfs(elements, out);
            out = out.replace("\"","");
            context.write(new Text(out),NullWritable.get());
        }
    }

    public static String dfs(Iterator<JsonNode> elements, String out){
        while(elements.hasNext()){
            JsonNode node = elements.next();
            if(node.isObject()){
                Iterator<JsonNode> e = node.elements();
                out = dfs(e, out);
            }else if(node.isArray()){
                for(int i=0;i<node.size();i++) {
                    if(node.get(i).isObject()){
                        Iterator<JsonNode> e2 = node.elements();
                        out = dfs(e2, out);
                        break;
                    }else{
                        out = out + node.get(i) + '\t';
                    }
                }
            }else{
                out = out + node.toString() + '\t';
            }
        }
        return out;
    }
}
```
