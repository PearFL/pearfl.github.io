---
title: hdfs简单API编程
date: 2020-1-7 19:40:33
tags:
 - hadoop
 - hdfs
categories: 大数据
---

```java
import org.apache.hadoop.conf.Configuration;
import org.apache.hadoop.fs.*;
import org.apache.hadoop.fs.permission.FsPermission;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;

import java.net.URI;

public class HDFSAPITest2 {
    FileSystem fileSystem;

    @Before
    public void setUp() throws Exception{
        URI uri = new URI("hdfs://hadoop:8020");
        Configuration configuration = new Configuration();

        configuration.set("dfs.client.use.datanode.hostname", "true");
        configuration.set("dfs.replication", "1");
        // 1) 获取HDFS客户端
        fileSystem = FileSystem.get(uri, configuration, "root");

    }

    @After
    public void shutdown() throws Exception{
        // 3) 关闭资源
        if(fileSystem != null){
            fileSystem.close();
        }
    }

    @Test
    public void mkdir() throws Exception {
        fileSystem.mkdirs(new Path("hdfs://hadoop:8020/hdfstest0"));
    }

    @Test
    public void copyFromLocalFile() throws Exception{
        Path src = new Path("data/ruozedata.txt");
        Path dst = new Path("/hdfstest");
        fileSystem.copyFromLocalFile(src, dst);
    }

    @Test
    public void copyToLocalFile() throws Exception{
        Path src = new Path("/20201011/146.txt");
        Path dst = new Path("output/146.txt");
        fileSystem.copyToLocalFile(src, dst);
    }

    @Test
    public void rename() throws Exception{
        Path src = new Path("/20201011/20201011-0.txt");
        Path dst = new Path("/20201011/146.txt");
        fileSystem.rename(src, dst);
    }

    @Test
    public void listFiles() throws Exception{
        RemoteIterator<LocatedFileStatus> files = fileSystem.listFiles(new Path("/20201011"), true);

        while(files.hasNext()){
            LocatedFileStatus fileStatus = files.next();
            String path = fileStatus.getPath().toString();
            long len = fileStatus.getLen();
            short replication = fileStatus.getReplication();
            FsPermission permission = fileStatus.getPermission();
            String isDir = fileStatus.isDirectory()? "文件夹" : "文件";

            System.out.println(path + "\t" + len + "\t" + replication + "\t" + permission + "\t" + isDir);

            BlockLocation[] blockLocations = fileStatus.getBlockLocations();
            for(BlockLocation location : blockLocations){
                String[] hosts = location.getHosts();
                for(String host : hosts){
                    System.out.println(host + "........");
                }
            }

        }
    }

    @Test
    public void delete() throws Exception{
        fileSystem.delete(new Path("/hdfstest"), true);
    }
}

```